<?php
/**
 * Created by PhpStorm.
 * User: Ivan
 * Date: 26-Apr-18
 * Time: 13:14
 */

namespace App\Http\Controllers\Admin;

use Backpack\CRUD\app\Http\Controllers\CrudController;
use App\Http\Requests\Admin\ScheduleCrudRequest as StoreRequest;
use App\Http\Requests\Admin\ScheduleCrudRequest as UpdateRequest;
use Illuminate\Http\Request;


class ScheduleCrudController extends CrudController
{

    public function setup()
    {
        $this->crud->setModel('App\Models\Schedule');
        $this->crud->setRoute('admin/schedule');
        $this->crud->setEntityNameStrings('schedule', 'schedules');
        $this->crud->setCreateView('lms/admin/schedule_create');


        //getting a list of all courses
        $courses = \App\Models\Course::all()->pluck('title','id')->toArray();

        //clearing the HTML tags from the names
        foreach ($courses as $key => $value) {
            $courses[$key] = strip_tags($value);
        }


        $this->crud->setColumns([
            [
                'name' => 'id',
                'label' => 'ID'
            ],
            [
                'name' => 'name',
                'label' => 'Name'
            ],
            [
                'name' => 'course_id',
                'label' => 'Course ID'
            ],
            [
                'name' => 'schedule_type',
                'label' => 'Schedule Type'
            ]
        ]);

        $this->crud->addField([
            'name' => 'name',
            'label' => 'Name'
        ]);

        $this->crud->addField([ // select_from_array
            'name' => 'schedule_type',
            'label' => "Schedule Type",
            'type' => 'select2_from_array',
            'options' => ['one' => 'locked', 'two' => 'dripped'],
            'allows_null' => true,
            'default' => 'null',
            // 'allows_multiple' => true, // OPTIONAL; needs you to cast this to array in your model;
        ]);

        $this->crud->addField([
            'label' => "Course ID",
            'type' => 'select2_from_array',
            'name' => 'course_id', // the db column for the foreign key
            'options' => $courses,
            'allows_null' => false,
            'default' => array_keys($courses)[0],
        ]);
    }

    public function store(StoreRequest $request)
    {
        return parent::storeCrud(); // TODO: Change the autogenerated stub
    }

    public function update(UpdateRequest $request)
    {
        return parent::updateCrud(); // TODO: Change the autogenerated stub
    }

}